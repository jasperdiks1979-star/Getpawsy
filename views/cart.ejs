<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>Shopping Cart | GetPawsy</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="/styles.css">
  <script src="/js/pawsy.js" defer></script>
</head>
<body class="pawsy-body">
  <%- include("partials/header") %>
  
  <main class="pawsy-main">
    <div class="pawsy-container">
      <div class="pawsy-cart-page">
        <h1 class="pawsy-page-title">Shopping Cart</h1>

        <% if (!cart || cart.length === 0) { %>
          <div class="pawsy-cart-empty">
            <div class="pawsy-cart-empty-icon">üõí</div>
            <h2>Your cart is empty</h2>
            <p>Looks like you haven't added anything yet. Let's find something for your furry friend!</p>
            <a href="/collections" class="pawsy-btn pawsy-btn-primary pawsy-btn-lg">Start Shopping</a>
          </div>
        <% } else { %>
          <% const cartSubtotal = typeof subtotal !== 'undefined' ? subtotal : 0; %>
          <% const cartTotal = typeof total !== 'undefined' ? total : '0.00'; %>
          <div class="pawsy-cart-layout">
            <div class="pawsy-cart-items">
              <% cart.forEach(item => { %>
                <div class="pawsy-cart-item" data-id="<%= item.id %>">
                  <div class="pawsy-cart-item-image">
                    <% const cartItemImgSrc = (item.images && item.images.length && item.images[0]) || item.image || '/images/placeholder.png'; %>
                    <img src="<%= cartItemImgSrc %>" alt="<%= item.name %>" onerror="this.src='/images/placeholder.png'">
                  </div>
                  <div class="pawsy-cart-item-details">
                    <h3 class="pawsy-cart-item-name"><%= item.name %></h3>
                    <p class="pawsy-cart-item-price">$<%= parseFloat(item.price).toFixed(2) %></p>
                  </div>
                  <div class="pawsy-cart-item-quantity">
                    <form action="/cart/update/<%= item.id %>" method="POST" class="pawsy-qty-form">
                      <button type="button" class="pawsy-qty-btn" onclick="this.nextElementSibling.stepDown(); this.form.submit();">‚àí</button>
                      <input type="number" name="qty" value="<%= item.qty %>" min="1" max="99">
                      <button type="button" class="pawsy-qty-btn" onclick="this.previousElementSibling.stepUp(); this.form.submit();">+</button>
                    </form>
                  </div>
                  <div class="pawsy-cart-item-subtotal">
                    $<%= (item.price * item.qty).toFixed(2) %>
                  </div>
                  <form action="/cart/remove/<%= item.id %>" method="POST">
                    <button type="submit" class="pawsy-cart-item-remove" title="Remove">
                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/>
                        <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                      </svg>
                    </button>
                  </form>
                </div>
              <% }) %>
            </div>

            <div class="pawsy-cart-summary">
              <h2>Order Summary</h2>
              <div class="pawsy-summary-row">
                <span>Subtotal</span>
                <span>$<%= cartSubtotal.toFixed(2) %></span>
              </div>
              <div class="pawsy-summary-row">
                <span>Shipping</span>
                <span><%= cartSubtotal >= 50 ? 'FREE' : '$5.99' %></span>
              </div>
              <% if (cartSubtotal < 50) { %>
                <div class="pawsy-free-shipping-notice">
                  Add $<%= (50 - cartSubtotal).toFixed(2) %> more for FREE shipping!
                </div>
              <% } %>
              <div class="pawsy-summary-divider"></div>
              <div class="pawsy-summary-row pawsy-summary-total">
                <span>Total</span>
                <span>$<%= cartTotal %></span>
              </div>
              <button type="button" class="pawsy-btn pawsy-btn-primary pawsy-btn-lg pawsy-checkout-btn" onclick="if(typeof startCheckoutUnified==='function'){startCheckoutUnified();}else{window.location.href='/checkout';}">
                Proceed to Checkout
              </button>
              <a href="/collections" class="pawsy-continue-shopping">‚Üê Continue Shopping</a>
            </div>
          </div>
        <% } %>
      </div>
    </div>
  </main>

  <%- include("partials/footer") %>
  <%- include("partials/pawsy_widget") %>

  <style>
    .pawsy-cart-page {
      padding: 2rem 0 4rem;
    }

    .pawsy-page-title {
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 2rem;
    }

    .pawsy-cart-empty {
      text-align: center;
      padding: 4rem 2rem;
      background: var(--pawsy-white);
      border-radius: var(--pawsy-radius-lg);
    }
    .pawsy-cart-empty-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }
    .pawsy-cart-empty h2 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }
    .pawsy-cart-empty p {
      color: var(--pawsy-gray-500);
      margin-bottom: 2rem;
    }

    .pawsy-cart-layout {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 2rem;
      align-items: start;
    }

    .pawsy-cart-items {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .pawsy-cart-item {
      display: grid;
      grid-template-columns: 100px 1fr auto auto auto;
      gap: 1.5rem;
      align-items: center;
      padding: 1.5rem;
      background: var(--pawsy-white);
      border-radius: var(--pawsy-radius-lg);
    }

    .pawsy-cart-item-image {
      width: 100px;
      height: 100px;
      border-radius: var(--pawsy-radius);
      overflow: hidden;
      background: var(--pawsy-light);
    }
    .pawsy-cart-item-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .pawsy-cart-item-name {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .pawsy-cart-item-price {
      color: var(--pawsy-gray-500);
      font-size: 0.9rem;
    }

    .pawsy-qty-form {
      display: flex;
      align-items: center;
      background: var(--pawsy-light);
      border-radius: var(--pawsy-radius);
    }
    .pawsy-qty-form .pawsy-qty-btn {
      width: 36px;
      height: 36px;
      font-size: 1.1rem;
    }
    .pawsy-qty-form input {
      width: 40px;
      text-align: center;
      border: none;
      background: transparent;
      font-weight: 600;
    }

    .pawsy-cart-item-subtotal {
      font-size: 1.1rem;
      font-weight: 700;
      min-width: 80px;
      text-align: right;
    }

    .pawsy-cart-item-remove {
      color: var(--pawsy-gray-500);
      padding: 0.5rem;
      border-radius: 50%;
    }
    .pawsy-cart-item-remove:hover {
      color: var(--pawsy-error);
      background: rgba(239, 68, 68, 0.1);
    }

    .pawsy-cart-summary {
      background: var(--pawsy-white);
      border-radius: var(--pawsy-radius-lg);
      padding: 2rem;
      position: sticky;
      top: 100px;
    }
    .pawsy-cart-summary h2 {
      font-size: 1.25rem;
      margin-bottom: 1.5rem;
    }

    .pawsy-summary-row {
      display: flex;
      justify-content: space-between;
      padding: 0.75rem 0;
      font-size: 0.95rem;
    }
    .pawsy-summary-total {
      font-size: 1.25rem;
      font-weight: 700;
    }

    .pawsy-summary-divider {
      height: 1px;
      background: var(--pawsy-gray-100);
      margin: 0.5rem 0;
    }

    .pawsy-free-shipping-notice {
      background: linear-gradient(135deg, var(--pawsy-primary) 0%, var(--pawsy-primary-light) 100%);
      color: var(--pawsy-dark);
      padding: 0.75rem 1rem;
      border-radius: var(--pawsy-radius);
      font-size: 0.85rem;
      font-weight: 600;
      text-align: center;
      margin: 1rem 0;
    }

    .pawsy-checkout-btn {
      width: 100%;
      margin-top: 1.5rem;
    }

    .pawsy-continue-shopping {
      display: block;
      text-align: center;
      margin-top: 1rem;
      color: var(--pawsy-gray-500);
      font-size: 0.9rem;
    }
    .pawsy-continue-shopping:hover {
      color: var(--pawsy-primary);
    }

    @media (max-width: 900px) {
      .pawsy-cart-layout {
        grid-template-columns: 1fr;
      }
      .pawsy-cart-item {
        grid-template-columns: 80px 1fr;
        gap: 1rem;
      }
      .pawsy-cart-item-quantity,
      .pawsy-cart-item-subtotal {
        grid-column: 2;
      }
    }
  </style>
  <!-- Fingerprint Badge (debug mode only) -->
  <% if (typeof debug !== 'undefined' && debug) { %>
  <div id="fpBadge" style="position:fixed;bottom:8px;left:8px;z-index:99999;background:rgba(0,0,0,0.9);color:#0f0;font-family:monospace;font-size:10px;padding:4px 8px;border-radius:4px;pointer-events:none;">LIVE: <%= typeof BUILD_FINGERPRINT !== 'undefined' ? BUILD_FINGERPRINT : 'unknown' %></div>
  <% } %>
</body>
</html>
